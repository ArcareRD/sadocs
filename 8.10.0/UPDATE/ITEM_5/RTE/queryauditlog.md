### <div id="user">規劃人員</div>
* Ivan

### <div id="updatedate">規劃日期</div>
* 2020/12/28

### <div id="trac">TRAC</div>
* #8264

### <div id="sitemanage_2">系統排程.稽核紀錄查詢 <path>(Site管理)</path></div>
* 擴充
* 規格說明
    * 僅企業管理員及稽核管理員可操作
    * Site稽核員僅檢視Site管理員及企業稽核員作業紀錄
    * 企業稽核員、企業管理員僅檢視相同企業所有人員紀錄
    * 可依查詢條件, 匯出CSV檔
    * 點選"內容"鍵, 可查詢駐留筆內容, 僅稽核管理員 可執行

* 表單畫面

    ![AuditLogQuery]

* 畫面規格說明
    * #### 表頭
        * 單選元件.近30天 : 
            * 查詢稽核紀錄LOG檔的稽核紀錄
            * 選擇時 : 
                * 查詢稽核紀錄LOG檔的資料
                * 欄位.查詢日期起、欄位.查詢日期迄 致能
                * 欄位.查詢年度月份 除能

        * 欄位.查詢日期起 :
            * 可空白
            * 有設定時，過濾執行時間大於等於欄位.查詢日期起 的資料
            * 未設定時，過濾則無限制執行時間起
            * 日期格式 : yyyy/mm/dd
            * 輸入內容須符合日期格式

        * 按鈕.挑選查詢日期起 :
            * 開啟行事曆
            * 點擊日期時關閉行事曆，更新欄位.查詢日期起

        * 欄位.查詢日期迄 :
            * 可空白
            * 有設定時，過濾執行時間小於等於欄位.查詢日期迄 的資料
            * 未設定時，過濾則無限制執行時間迄
            * 日期格式 : yyyy/mm/dd
            * 輸入內容須符合日期格式

        * 按鈕.挑選查詢日期迄 :
            * 開啟行事曆
            * 點擊日期時關閉行事曆，更新欄位.查詢日期迄

        * 單選元件.年度月份 : 
            * 查詢指定年度月份的稽核紀錄
            * 選擇時 : 
                * 欄位.查詢年度月份 致能
                * 欄位.查詢日期起、欄位.查詢日期迄 除能

        * 欄位.查詢年度月份 :
            * 不可空白
            * 過濾指定年度月份的月份檔稽核紀錄
            * 日期格式 : yyyy/mm
            * 輸入內容須符合日期格式

        * 按鈕.挑選查詢年度月份 :
            * 開啟行事曆
            * 點擊日期時關閉行事曆，更新欄位.年度月份

        * 欄位.查詢人員 :
            * 可空白
            * 有設定時，過濾使用者等於欄位.查詢人員 的資料
            * 未設定時 :
                * 登入者為Site稽核員 :
                    * 過濾使用者等於 自己 或 Site管理員 或 企業稽核員 的資料
                * 登入者為企業稽核員、企業管理員 :
                    * 過濾使用者等於 自己 或 企業人員 的資料
        
        * 按鈕.挑選查詢人員 :
            * 登入者為Site稽核員 :
                * 開啟<<人員清單>>，僅顯示 自己 或 Site管理員 或 企業稽核員 的資料
            * 登入者為企業稽核員、企業管理員 :
                * 開啟<<人員清單>>，僅顯示 自己 或 企業人員 的資料
            * 雙擊人員資料時關閉快顯視窗，更新欄位.查詢人員

        * 欄位.查詢系統 :
            * 可空白
            * 有設定時，過濾系統等於欄位.查詢系統 的資料
            * 未設定時 :
                * 登入者為Site稽核員 :
                    * 過濾所有系統的資料
                * 登入者為企業稽核員、企業管理員 :
                    * 過濾系統等於企業所屬系統的資料

        * 按鈕.挑選查詢系統 :
            * 登入者為Site稽核員 :
                * 開啟<<系統清單>>，顯示所有系統
            * 登入者為企業稽核員、企業管理員 :
                * 開啟<<系統清單>>，僅顯示企業所屬系統
            * 雙擊系統名稱時關閉快顯視窗，更新欄位.查詢系統

        * 欄位.查詢頁面 :
            * 可空白
            * 有設定時，過濾動作頁面等於欄位.查詢頁面 的資料
            * 未設定時，過濾所有動作頁面的資料

        * 按鈕.挑選查詢頁面 :
            * 當欄位.查詢週期 = 年度月份 AND 欄位.查詢年度月份 為空時不允執行
            * 開啟<<動作頁面清單>>
            * 欄位.查詢週期 = 近30天 :
                * 顯示稽核紀錄LOG檔內所有的動作頁面(去重複)
            * 欄位.查詢週期 = 年度月份 :
                * 顯示年度月份檔內所有的動作頁面(去重複)
            * 雙擊動作頁面時關閉快顯視窗，更新欄位.查詢頁面

        * 按鈕.匯出 :
            * 依查詢條件匯出CSV檔
            * 當登入者為稽核員 且 欄位.包含明細 有勾選時，匯出資料包含Request、Response明細

        * 欄位.包含明細 :
            * 匯出CSV檔的資料是否包含Request、Response明細
            * 當登入者不為稽核員時除能

        * 按鈕.查詢 : 依查詢條件過濾資料並顯示於表身

    * #### 表身
        * 欄位.日期時間 : 顯示稽核紀錄的執行時間
        
        * 欄位.企業 : <ps>待確認顯示企業當地名稱或企業英文名稱</ps>

        * 欄位.使用者 : 顯示稽核紀錄的使用者名稱

        * 欄位.系統名稱 : 顯示稽核紀錄的系統名稱(寫入時給值系統預設語系的多語內容)

        * 欄位.組織編號 : 顯示稽核紀錄的組織編號(寫入時給值系統預設語系的多語內容)

        * 欄位.動作頁面(Action_FMD) : 
            * 顯示稽核紀錄的表單名稱 :
                * 若為Site表單 : 寫入時給值表單英文名稱
                * 若為系統表單 : 寫入時給值系統預設語系的多語內容

        * 欄位.動作代號(Action_ID) : 
            * 顯示稽核紀錄的動作名稱(寫入時依SERVLETPATH判斷給值:異動/查詢)

        * 欄位.錯誤訊息 : 顯示稽核紀錄的Response錯誤訊息

        * 欄位.連結AP : 顯示稽核紀錄的執行HOST

        * 欄位.來源IP : 顯示稽核紀錄的使用者IP位置

        * 按鈕.內容 :
            * 開啟<<稽核紀錄內容>>
            * 當登入者不為稽核員時除能

* 作業流程
    * 開啟稽核紀錄查詢畫面

    ![AuditLogQuery_sa1]

    * 點擊單選元件.近30天

    ![AuditLogQuery_sa2]

    * 點擊單選元件.年度月份

    ![AuditLogQuery_sa3]

    * 點擊按鈕.挑選查詢日期起

    ![AuditLogQuery_sa4]

    * 點擊按鈕.挑選查詢日期迄

    ![AuditLogQuery_sa5]

    * 點擊按鈕.挑選查詢年度月份

    ![AuditLogQuery_sa6]

    * 點擊按鈕.挑選查詢人員

    ![AuditLogQuery_sa7]

    * 點擊按鈕.挑選查詢系統

    ![AuditLogQuery_sa8]

    * 點擊按鈕.挑選查詢頁面

    ![AuditLogQuery_sa9]

    * 點擊按鈕.匯出

    ![AuditLogQuery_sa10]

    * 點擊按鈕.查詢

    ![AuditLogQuery_sa11]

    * 點擊按鈕.內容

    ![AuditLogQuery_sa12]

<!--超連結引用ps.畫面上看不到-->
[AuditLogQuery]:img/AuditLogQuery.jpg
[AuditLogQuery_sa1]:img/AuditLogQuery_sa1.jpg
[AuditLogQuery_sa2]:img/AuditLogQuery_sa2.jpg
[AuditLogQuery_sa3]:img/AuditLogQuery_sa3.jpg
[AuditLogQuery_sa4]:img/AuditLogQuery_sa4.jpg
[AuditLogQuery_sa5]:img/AuditLogQuery_sa5.jpg
[AuditLogQuery_sa6]:img/AuditLogQuery_sa6.jpg
[AuditLogQuery_sa7]:img/AuditLogQuery_sa7.jpg
[AuditLogQuery_sa8]:img/AuditLogQuery_sa8.jpg
[AuditLogQuery_sa9]:img/AuditLogQuery_sa9.jpg
[AuditLogQuery_sa10]:img/AuditLogQuery_sa10.jpg
[AuditLogQuery_sa11]:img/AuditLogQuery_sa11.jpg
[AuditLogQuery_sa12]:img/AuditLogQuery_sa12.jpg