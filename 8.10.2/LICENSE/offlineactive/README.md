# 認證授權中心 離線啟用授權

### <div id="view">畫面</div>
* 當客戶端主機不具備外部網路連線能力，讓客戶端維護人員在透過該頁面上傳授權檔案並進行啟用。
* 離線啟用流程如下
![流程]

* 畫面如下

![畫面]

* 該頁面不須登入權限
* 以下為畫面上各欄位的功能說明
    * 1.欄位.啟用授權檔案類型
      * 必要欄位
      * 下拉欄位 : 選項內容如下
        * RTE站台授權
        * RTE系統授權
    * 2.欄位.上傳授權檔案
      * 必要欄位
      * 檔案挑選欄位
      * 點擊欄位後可開啟檔案總管，讓維運人員挑選授權檔案上傳
    * 3.按鈕.產生離線啟用檔案
      * 點擊後執行以下動作
          * 判斷 欄位.啟用授權檔案類型
            * 不可為空，若為空則顯示錯誤訊息【請挑選啟用授權檔案類型】
          * 判斷 欄位.上傳授權檔案 不可為空，若為空則顯示錯誤訊息【請挑選上傳授權檔案】
          * 驗證上傳授權檔案的內容
              * 使用RTE金鑰對-私鑰加密過的授權資料
                  * 確認授權檔案是否能被解密且驗證數位簽章通過
                  * 確認該授權檔案資訊存在於授權資料庫中
                  * 確認授權檔案對應紀錄是否未失效
                  * 確認授權檔案對應紀錄是否未過期
                  * 確認授權檔案內容是否帶有客戶端主機資訊
                    * 若為RTE站台授權，需要帶有以下客戶端主機資訊
                      * 站台主機MAC Address
                      * 站台主機電腦名稱
                    * 若為RTE系統授權，需要帶有以下客戶端主機資訊
                      * 站台主機MAC Address
                      * 站台主機電腦名稱
                      * 啟用企業名稱
            * 授權檔案的格式同[線上啟用授權API](../onlineactive/README.md)中的傳入參數.source以及傳入參數.signature
          * 將資料庫中該站台授權的站台狀態設定為已啟用，並更新啟用資訊
          * 以授權中心金鑰對-私鑰加密並簽章
              * 產生新的授權啟用檔案並自動下載
                * 授權啟用檔案的內容包含以下部分
                  * 加密過的授權啟用資料
                  * 數位簽章
                * 同[線上啟用授權API](../onlineactive/README.md)中的回傳結果.license

### <div id="flow">流程</div>
* 點擊按鈕.產生離線啟用檔案

![點擊按鈕.產生離線啟用檔案]


[畫面]:attachment/offlineactive_view.png "畫面"
[流程]:attachment/軟體授權碼離線啟用站台.png "流程"
[點擊按鈕.產生離線啟用檔案]:attachment/點擊按鈕.產生離線啟用檔案.png "點擊按鈕.產生離線啟用檔案"