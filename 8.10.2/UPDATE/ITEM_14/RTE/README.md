### <div id="user">規劃人員</div>
* 佩玲

### <div id="updatedate">規劃日期</div>
* 2022/10/14

### <div id="trac">TRAC</div>
* #9138

### <div id="require">需求說明</div>
* 提供企業/系統管理者可設定帳號生效方式(人工或自動)；並於帳號生效後，依設定自動對應至指定的系統、組織，及角色權限

### <div id="workflow">作業流程</div>

### <div id="requirement">需求展開</div>
* 作業流程

  ![作業流程]

* Site管理  
  * 異動介面.其他參數
    * 在開放帳號申請設定中，增加下列欄位
      * 欄位.到期通知天數，預設帳號的系統使用期限到期前的第n天要通知使用者
      * 欄位.逾期可使用天數，預設帳號的系統使用期限到期後，仍可使用的天數
  * 新增介面.帳號生效參數查詢
    * 由Site系統服務的選單開啟
    * 可編修及瀏覽權限的角色: 企業管理員/系統管理員
    * 完整規格文件，請看: [帳號生效參數查詢][link_accounteffectparamquery]
  * 新增介面.帳號生效參數設定
    * 由介面.帳號生效參數查詢，執行按鈕.新增，開啟本單
    * 可編修及瀏覽權限的角色: 企業管理員/系統管理員
    * 完整規格文件，請看: [帳號生效參數設定][link_accounteffectparamsetting]      
  * 異動介面.帳號申請
    * 當瀏覽器的連結網址存在帳號生效參數設定的唯一號，預設帶入企業代號，並跳過介面.**請輸入企業名稱**
    * 增加發送Mail有效性驗證碼，由使用者回填驗證碼；Mail驗證碼要有效期，預設: 1分鐘，1分鐘後未回填，使用者須重新申請發送驗證碼
    * 送出後，判斷瀏覽器的連結網址是否存在帳號生效參數設定的唯一號
      * 存在參數唯一號 且 帳號生效方式=自動，由系統自動建立申請帳號的資訊並生效
        * 預設給該帳號，參數唯一號指定的系統、到期通知天數、逾期可使用天數、組織，及角色權限
        * 當有效期限=到期日，預設 帳號使用系統的**使用效期**為 **到期日**
        * 當有效期限=天數，預設 帳號使用該系統的**使用效期**為 **系統日期+天數**
      * 不存在參數唯一號 或 (存在參數唯一號 且 帳號生效方式=人工)，僅建立申請帳號資訊，但帳號不生效
    * 完整規格文件，請看 [帳號申請][link_applyaccount]
  * 異動介面.帳號清單
    * 按鈕.生效，判斷若申請帳號是使用介面.**帳號生效參數設定**的連結URL建立的，則生效時，增加下列寫入資訊
        * 預設給該帳號，參數唯一號指定的系統、到期通知天數、逾期可使用天數、組織，及角色權限
        * 當有效期限=到期日，預設 帳號使用系統的**使用效期**為 **到期日**
        * 當有效期限=天數，預設 帳號使用該系統的**使用效期**為 **系統日期+天數**
    * 按鈕.系統，開啟的介面.**系統**，增加下列欄位
      * 欄位.使用效期，指定該帳號對應系統的有效期限
      * 欄位.到期通知天數，預帶介面.**其他參數**的**到期通知天數**
      * 欄位.逾期可使用天數，預帶介面.**其他參數**的**逾期可使用天數**
    * 完整規格文件，請看 [帳號清單][link_accountindex]
  * 異動介面.系統_使用者設定
    * 分頁: 依系統指定、依帳號指定，增加下列欄位
      * 欄位.使用效期，可指定該帳號對應系統的有效期限
      * 欄位.到期通知天數，預帶介面.**其他參數**的**到期通知天數**
      * 欄位.逾期可使用天數，預帶介面.**其他參數**的**逾期可使用天數**
  * 異動介面.系統_管理員設定
    * 分頁: 依系統指定、依帳號指定，增加下列欄位
      * 欄位.使用效期，可指定該帳號對應系統的有效期限
      * 欄位.到期通知天數，預帶介面.**其他參數**的**到期通知天數**
      * 欄位.逾期可使用天數，預帶介面.**其他參數**的**逾期可使用天數**
  * 異動介面.系統_使用系統申請查詢
    * 按鈕.核准，改Dialog開啟介面.**系統申請核准設定**，傳入勾選的帳號及申請系統
  * 新增介面.系統申請核准設定
    * 由介面.系統_使用系統申請查詢，執行按鈕.核准，開啟本單
    * 可編修及瀏覽權限的角色: 企業管理員/系統管理員
    * 完整規格文件，請看: [系統申請核准設定][link_systemapplicationapproval]
  * 擴充 RTE 引擎預設排程
    * 每日檢查介面.**帳號生效參數設定**，以下條件成立時，發送通知信至系統管理員的郵件信箱
      * 當 **有效期限** 等於 **到期日**，依 **到期日-到期通知天數** 的日期，發送系統使用期限即將到期通知信
      * 當 **申請人數限制** 大於等於 **已申請人數**，發送系統申請人數已額滿通知信
    * 每日檢查下列帳號資訊
      * 檢查帳號下各系統的 **使用效期-到期通知天數** 的日期，若為今天的日期，發送各系統中使用效期即將到期的帳號清單通知信至系統管理員的郵件信箱
      * 檢查帳號下各系統的 **使用效期-到期通知天數** 的日期，若為今天的日期，發送即將到期的系統清單至帳號的郵件信箱
      * 檢查帳號下各系統的 **使用效期** 若為今天的日期 且 已超過**逾期可使用天數**，發送系統使用效期已到期通知至帳號的郵件信箱
* 系統(System)
  * 異動介面.RTE登入畫面
    * 突顯申請新帳號的樣式
    * 當瀏覽器的連結網址存在帳號生效參數設定的唯一號，即使Site系統服務介面.**其他參數**的欄位.**開放帳號申請**未勾選，畫面仍顯示**申請新帳號**的連結
    * 完成整規格文件，請看[RTE登入畫面][link_login]
  * 異動介面.RTE首頁
    * 切換系統分公司的清單，增加 帳號對應系統的使用效期，已過期的系統，不顯示  
    * 切換系統時，判斷若申請帳號是否使用介面.**帳號生效參數設定**的連結URL建立的，決定下列檢控
      * 否，若帳號對此系統的 **有效期限已到期**，則顯示已到期訊息，且切換無效，回到上次選取的系統 
      * 是，
        * 若帳號對此系統的 **有效期限-到期通知天數** 小於 **有效期限**，提示即將到期訊息，仍可切換系統
        * 若帳號對此系統的 **有效期限已到期** 且 **超到逾期可使用天數**，則顯示已到期訊息，不可切換系統
        * 若帳號對此系統的 **有效期限已到期** 且 **未超過逾期可使用天數**，顯示已到期及剩餘可使用天數訊息，仍可切換系統


[作業流程]:attachment/8319_workflow.png "作業流程"

[link_accounteffectparamquery]:{3}/RTE/SITE/accounteffectparamquery/README
[link_accounteffectparamsetting]:{3}/RTE/SITE/accounteffectparamsetting/README
[link_login]:{3}/RTE/SYSTEM/LOGIN/README
[link_applyaccount]:{3}/RTE/SYSTEM/APPLYACCOUNT/README
[link_accountindex]:{3}/RTE/SITE/accountindex/README