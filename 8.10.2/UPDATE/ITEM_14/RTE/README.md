### <div id="user">規劃人員</div>
* 佩玲

### <div id="updatedate">規劃日期</div>
* 2022/10/14

### <div id="trac">TRAC</div>
* #9138

### <div id="require">需求說明</div>
* 提供企業/系統管理者可設定帳號生效方式(人工或自動)；並於帳號生效後，依設定自動對應至指定的系統、組織，及角色權限

### <div id="workflow">作業流程</div>

### <div id="requirement">需求展開</div>
* 作業流程

  ![作業流程]

* 新增介面.帳號生效參數查詢
  * 由Site系統服務的選單開啟
  * 可編修及瀏覽權限的角色: 企業管理員/系統管理員
  * 規格文件，請看: [帳號生效參數查詢][link_accounteffectparamquery]
* 新增介面.帳號生效參數設定
  * 由介面.帳號生效參數查詢，執行按鈕.新增，開啟本單
  * 可編修及瀏覽權限的角色: 企業管理員/系統管理員
  * 規格文件，請看: [帳號生效參數設定][link_accounteffectparamsetting]
* 異動介面.登入畫面
  * 突顯申請新帳號的樣式
  * 完成整規格文，請看[RTE登入畫面][link_login]
* 異動介面.帳號申請
  * 增加發送Mail有效性驗證碼，由使用者回填驗證碼；Mail驗證碼要有效期，預設: 1分鐘，1分鐘後未回填，使用者須重新申請發送驗證碼
  * 送出後，判斷網址是否存在帳號生效參數設定的唯一號
    * 存在參數唯一號 且 帳號生效方式=自動，由系統自動建立申請帳號的資訊並生效
      * 依參數唯一號寫入指定的系統、組織，及角色權限
      * 當有效期限=到期日，預設 帳號使用該系統的有效日期等於 **到期日**
      * 當有效期限=天數，預設 帳號使用該系統的有效日期等於 **系統日期+天數**
    * 不存在參數唯一號，或 存在參數唯一號 且 帳號生效方式=人工，建立申請帳號資訊，但帳號不生效
  * 完整規格文件，請看 [帳號申請][link_applyaccount]
* 異動介面.帳號清單
  * 按鈕.生效，判斷若申請帳號是使用介面.**帳號生效參數設定**的連結URL建立的，則生效時，增加下列寫入資料
      * 依參數唯一號寫入指定的系統、組織，及角色權限
      * 當有效期限=到期日，預設帳號失效日期等於 **到期日**
      * 當有效期限=天數，預設帳號失效日期等於 **系統日期+天數**
  * 完整規格文件，請看 [帳號清單][link_accountindex]
* 擴充 RTE 引擎預設排程
  * 每日檢查介面.**帳號生效參數設定**
    * 以下條件成立時，發送通知信至系統管理員的信箱
      * 當 **有效期限** 等於 **到期日**，依 **到期日-到期通知天數** 的日期，發送系統使用期限即將到期通知信
      * 當 **申請人數限制** 大於等於 **已申請人數**，發送系統申請人數已額滿通知信
      * 當 帳號 是使用介面.**帳號生效參數設定**的連結URL建立的，取得 **帳號使用系統的有效日期-各參數到期通知天數**，發送各系統即將使用到期的帳號清單通知信
    * 當 帳號 是使用介面.**帳號生效參數設定**的連結URL建立的, 以下條件成立時，發送通知信至對應帳號的信箱
      * 當 **帳號使用系統的有效日期-到期通知天數** 的日期，發送帳號即將到期通知信
      * 當 **帳號使用系統的有效日期** 已到期，且 **逾期可使用天數** 不為 **0**，發送帳號已逾期通知信


[作業流程]:attachment/8319_workflow.png "作業流程"

[link_accounteffectparamquery]:{3}/RTE/SITE/accounteffectparamquery/README
[link_accounteffectparamsetting]:{3}/RTE/SITE/accounteffectparamsetting/README
[link_login]:{3}/RTE/SYSTEM/LOGIN/README
[link_applyaccount]:{3}/RTE/SYSTEM/APPLYACCOUNT/README
[link_accountindex]:{3}/RTE/SITE/accountindex/README